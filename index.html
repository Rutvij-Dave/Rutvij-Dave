<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rutvij Dave â€” Final Form Portfolio</title>

<!-- Favicon -->
<link rel="icon" href="data:image/svg+xml;utf8,
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
  <defs><linearGradient id='g' x1='0' x2='1'><stop offset='0' stop-color='#00e5ff'/><stop offset='1' stop-color='#8c7bff'/></linearGradient></defs>
  <rect width='100' height='100' rx='20' fill='#080b16' />
  <text x='50%' y='57%' font-size='46' text-anchor='middle' fill='url(%23g)' font-family='Poppins, Inter, Arial' font-weight='800'>RD</text>
</svg>">

<meta name="description" content="Rutvij Dave â€” Senior Data Engineer. Flagship interactive portfolio." />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">

<!-- CDN libs (non-module for GitHub Pages compatibility) -->
<script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
<script src="https://unpkg.com/gsap@3.12.2/dist/gsap.min.js"></script>
<script src="https://unpkg.com/gsap@3.12.2/dist/ScrollTrigger.min.js"></script>

<style>
:root{
  --bg:#020318;
  --muted:#9fb0c7;
  --accent1:#00e5ff;
  --accent2:#8c7bff;
  --glass: rgba(255,255,255,0.03);
  --maxw:1200px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:radial-gradient(1000px 600px at 10% 15%, rgba(8,12,30,0.6), transparent), var(--bg);color:#eaf2ff;font-family:Inter, Poppins, system-ui,-apple-system,"Segoe UI",Roboto}
a{color:inherit;text-decoration:none}

/* ---------- Loader ---------- */
#loader{
  position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:99999;
  background:linear-gradient(180deg, rgba(1,3,8,0.98), rgba(3,6,14,0.98));
  flex-direction:column;transition:opacity .6s, visibility .6s;
}
.load-logo{
  width:112px;height:112px;border-radius:20px;background:linear-gradient(135deg,var(--accent1),var(--accent2));
  display:flex;align-items:center;justify-content:center;font-weight:900;color:#071022;font-size:34px;box-shadow:0 18px 80px rgba(0,0,0,.6);
}
.load-text{color:var(--muted);margin-top:14px}

/* ---------- Decorative blobs ---------- */
.blob{position:fixed;pointer-events:none;border-radius:50%;filter:blur(90px) saturate(120%);opacity:.12;z-index:0}
.blob.a{width:720px;height:720px;left:-14%;top:4%;background:radial-gradient(circle,var(--accent1),transparent 45%)}
.blob.b{width:520px;height:520px;right:-10%;bottom:6%;background:radial-gradient(circle,var(--accent2),transparent 45%)}

/* ---------- WebGL canvas ---------- */
#glCanvas{position:fixed;inset:0;z-index:0;pointer-events:none;display:block}

/* ---------- Cursor & trailing dots ---------- */
.cursor{
  position:fixed;left:50%;top:50%;width:34px;height:34px;border-radius:50%;pointer-events:none;z-index:2000;
  border:2px solid var(--accent1); box-shadow:0 0 12px var(--accent1), 0 0 40px var(--accent2);
  transform:translate(-50%,-50%);transition:width .18s,height .18s,transform .08s,opacity .12s;
  background:radial-gradient(circle, rgba(0,229,255,0.08), transparent 50%);
}
.trail{position:fixed;pointer-events:none;width:10px;height:10px;border-radius:50%;background:var(--accent1);filter:blur(8px);opacity:.9;transform:translate(-50%,-50%);z-index:1900}

/* ---------- Header / Holographic nav ---------- */
.header{
  position:fixed;left:0;right:0;top:18px;display:flex;justify-content:space-between;align-items:center;padding:0 6%;z-index:50;
  backdrop-filter:blur(18px) saturate(160%); background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); box-shadow:0 10px 40px rgba(0,0,0,0.45);
}
.brand{font-weight:800;letter-spacing:.4px}
.nav{display:flex;gap:14px;align-items:center}
.nav a{padding:8px 12px;border-radius:10px;color:rgba(230,238,248,.95);font-weight:700;position:relative}
.nav a::after{content:"";position:absolute;left:12px;right:12px;height:2px;bottom:-8px;background:linear-gradient(90deg,var(--accent1),var(--accent2));opacity:0;transform:scaleX(.2);transform-origin:left;transition:all .22s}
.nav a:hover::after{opacity:1;transform:scaleX(1)}
.btn{padding:10px 14px;border-radius:12px;background:linear-gradient(90deg, rgba(0,229,255,0.06), rgba(140,123,255,0.04));border:1px solid rgba(255,255,255,0.03);font-weight:800;color:#e9fbff}

/* ---------- Hero ---------- */
.hero{min-height:86vh;display:flex;align-items:center;justify-content:center;padding:10vh 6%;text-align:center;z-index:2}
.kicker{display:inline-block;padding:6px 12px;border-radius:999px;background:linear-gradient(90deg, rgba(0,229,255,0.06), rgba(140,123,255,0.04));color:var(--accent1);font-weight:700;margin-bottom:18px;font-size:13px}
.h1{font-size:clamp(36px,7vw,86px);line-height:1;margin:0;background:linear-gradient(90deg,var(--accent1),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:900;position:relative}
.h1::after{content:"";position:absolute;inset:-16px;background:radial-gradient(circle,var(--accent1),transparent 60%);filter:blur(40px);opacity:.2;z-index:-1;animation:aura 4s ease-in-out infinite}
@keyframes aura{0%,100%{transform:scale(1)}50%{transform:scale(1.12)}}
.h2{color:var(--muted);margin-top:14px;font-size:18px}

/* ---------- Intro card ---------- */
.intro{margin-top:36px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px;display:flex;gap:18px;align-items:center;justify-content:center;max-width:920px;margin-left:auto;margin-right:auto}
.intro p{margin:0;color:var(--muted)}

/* ---------- Sections ---------- */
section{padding:92px 6%;position:relative;z-index:2}
.container{max-width:var(--maxw);margin:0 auto}
.section-title{font-weight:800;font-size:28px;margin-bottom:18px}

/* skills */
.skills{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:16px}
.skill{padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.03)}
.bar{height:12px;background:rgba(0,0,0,0.25);border-radius:999px;overflow:hidden}
.fill{height:100%;width:0;background:linear-gradient(90deg,var(--accent1),var(--accent2));border-radius:999px}

/* projects - glass morph + spotlight */
.projects-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:22px}
.project{
  position:relative;padding:18px;border-radius:12px;background:linear-gradient(160deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
  backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.06);
  transition:transform .36s,box-shadow .36s;
  overflow:hidden;
}
.project:hover{transform:translateY(-10px);box-shadow:0 30px 120px rgba(0,0,0,0.6)}
.project .spot{position:absolute;left:0;top:0;width:180px;height:180px;border-radius:50%;pointer-events:none;mix-blend-mode:screen;filter:blur(36px);opacity:0;transform:translate(-50%,-50%);transition:all .25s}

/* modal */
.modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,0.6);visibility:hidden;opacity:0;transition:opacity .24s;z-index:9999;padding:24px}
.modal.show{visibility:visible;opacity:1}
.panel{width:100%;max-width:980px;background:#071226;padding:20px;border-radius:12px;border:1px solid rgba(255,255,255,0.04)}

/* reveal util */
.reveal{opacity:0;transform:translateY(24px);transition:all .9s cubic-bezier(.2,.9,.2,1)}
.reveal.show{opacity:1;transform:translateY(0)}

/* responsive */
@media(max-width:880px){ .skills{grid-template-columns:1fr} .h1{font-size:36px} .header{padding:12px 4%} }
</style>
</head>
<body>

<!-- Loader -->
<div id="loader" role="status" aria-hidden="false">
  <div class="load-logo">RD</div>
  <div class="load-text">Booting flagship experienceâ€¦</div>
</div>

<!-- decorative blobs -->
<div class="blob a" aria-hidden="true"></div>
<div class="blob b" aria-hidden="true"></div>

<!-- WebGL canvas -->
<canvas id="glCanvas" aria-hidden="true"></canvas>

<!-- cursor + trail container -->
<div class="cursor" id="cursor" aria-hidden="true"></div>
<div id="trail-root" aria-hidden="true"></div>

<!-- header -->
<header class="header" role="banner">
  <div class="brand">Rutvij <span style="opacity:.75">Dave</span></div>
  <nav class="nav" role="navigation" aria-label="primary">
    <a href="#about">About</a>
    <a href="#skills">Skills</a>
    <a href="#projects">Projects</a>
    <a href="#contact">Contact</a>
    <button class="btn" id="resumeBtn" title="Download resume">Resume</button>
    <button class="btn" id="perfBtn" title="Toggle heavy visuals">Perf: Full</button>
  </nav>
</header>

<!-- main content -->
<main>
  <section class="hero" id="home" aria-labelledby="hero-title">
    <div class="hero-inner">
      <div class="kicker">Senior Data Engineer â€¢ Cloud & Big Data</div>
      <h1 class="h1" id="hero-title">I build <span id="type">scalable data platforms</span></h1>
      <p class="h2">Snowflake â€¢ AWS â€¢ ETL/ELT â€¢ Data Modeling â€¢ Observability</p>

      <div style="margin-top:28px">
        <a class="btn" href="#projects">See Projects</a>
        <a class="btn" href="#contact">Contact</a>
        <a class="btn" id="audioToggle" href="#" title="Enable sound reactive demo">Enable Sound</a>
      </div>

      <div class="intro" aria-label="Snapshot" style="margin-top:32px">
        <div class="meta">
          <strong style="display:block">Snapshot</strong>
          <p style="color:var(--muted);margin:6px 0 0 0">7+ years experience â€¢ 5+ years Data Engineering â€¢ AWS â€¢ Snowflake â€¢ ETL â€¢ Observability</p>
        </div>
      </div>
    </div>
  </section>

  <section id="about" class="reveal">
    <div class="container two-col">
      <div>
        <div class="section-title">About</div>
        <p style="color:var(--muted)">I design and build large-scale data platforms and data engineering systems. My focus: scalable ETL, observability, automation, and analytics-ready warehouses.</p>
      </div>
      <div>
        <div style="border-radius:12px;padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03)">
          <h4 style="margin:0 0 8px 0">Contact</h4>
          <p style="color:var(--muted);margin:0">ðŸ“ž +91 884 9214 912<br>ðŸ“§ <a href="mailto:your@email.com" style="color:var(--accent1)">your@email.com</a></p>
        </div>
      </div>
    </div>
  </section>

  <section id="skills" class="reveal">
    <div class="container">
      <div class="section-title">Skills & Tools</div>
      <div class="skills">
        <div class="skill"><h4>AWS â€” Cloud Platforms</h4><div class="bar"><div class="fill" data-w="90%"></div></div></div>
        <div class="skill"><h4>Snowflake â€” Data Warehousing</h4><div class="bar"><div class="fill" data-w="85%"></div></div></div>
        <div class="skill"><h4>SQL â€” Data Engineering</h4><div class="bar"><div class="fill" data-w="92%"></div></div></div>
        <div class="skill"><h4>Data Engineering â€” Pipelines & Modeling</h4><div class="bar"><div class="fill" data-w="95%"></div></div></div>
      </div>
    </div>
  </section>

  <section id="projects" class="reveal">
    <div class="container">
      <div class="section-title">Selected Projects</div>
      <div class="projects-grid">
        <article class="project" tabindex="0" data-title="Enterprise Warehouse" data-desc="Snowflake architecture, dimensional modelling, performance tuning.">
          <div class="spot" style="background:radial-gradient(circle, rgba(0,229,255,.45), rgba(140,123,255,.08));"></div>
          <div class="tag" style="font-weight:800;color:var(--accent1)">Snowflake</div>
          <h3>Enterprise Warehouse</h3>
          <p style="color:var(--muted)">Optimized models & marts for analytics teams.</p>
          <div style="margin-top:12px"><button class="btn" onclick="openModal(this)">Preview</button></div>
        </article>

        <article class="project" tabindex="0" data-title="Pipeline Framework" data-desc="Automated ETL pipelines, orchestrations, retries & observability.">
          <div class="spot" style="background:radial-gradient(circle, rgba(140,123,255,.45), rgba(0,229,255,.08));"></div>
          <div class="tag" style="font-weight:800;color:var(--accent2)">ETL</div>
          <h3>Pipeline Framework</h3>
          <p style="color:var(--muted)">Reliable ingestion & schema evolution at scale.</p>
          <div style="margin-top:12px"><button class="btn" onclick="openModal(this)">Preview</button></div>
        </article>

        <article class="project" tabindex="0" data-title="Analytics Platform" data-desc="Analytics-ready models, serving tables & dashboards.">
          <div class="spot" style="background:radial-gradient(circle, rgba(0,229,255,.45), rgba(140,123,255,.08));"></div>
          <div class="tag" style="font-weight:800;color:var(--accent1)">Analytics</div>
          <h3>Analytics Platform</h3>
          <p style="color:var(--muted)">Near real-time KPIs & serving layers for BI tools.</p>
          <div style="margin-top:12px"><button class="btn" onclick="openModal(this)">Preview</button></div>
        </article>
      </div>
    </div>
  </section>

  <section id="contact" class="reveal">
    <div class="container">
      <div class="section-title">Contact</div>
      <p style="color:var(--muted)">Interested in collaborating? Reach out â€” I respond quickly.</p>
      <p style="color:var(--muted)">ðŸ“ž +91 884 9214 912 â€¢ ðŸ“§ <a href="mailto:your@email.com" style="color:var(--accent1)">your@email.com</a></p>
    </div>
  </section>
</main>

<!-- modal -->
<div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="panel">
    <button class="close" onclick="closeModal()" aria-label="Close modal" style="float:right;background:transparent;border:0;color:var(--muted);font-weight:700">âœ•</button>
    <h3 id="modal-title"></h3>
    <p id="modal-desc" style="color:var(--muted)"></p>
    <div style="margin-top:16px"><a class="btn" href="#contact">Contact about this project</a></div>
  </div>
</div>

<footer style="padding:48px 6%;text-align:center;color:var(--muted)">Â© Rutvij Dave â€” Final Form</footer>

<script>
/* =============================
   Helpers
   ============================= */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));

/* ---------- Loader safety ---------- */
function hideLoader() {
  const l = $('#loader');
  if(!l) return;
  l.style.opacity = 0;
  l.style.visibility = 'hidden';
}
window.addEventListener('load', ()=> {
  // entrance choreography
  gsap.from('.brand', {y:-8, opacity:0, duration:.6});
  gsap.from('.kicker', {y:8, opacity:0, duration:.8, delay:.08});
  gsap.from('#hero-title', {y:24, opacity:0, duration:.9, delay:.12, ease:'expo.out'});
  gsap.from('.h2', {y:20, opacity:0, duration:.9, delay:.22});
  // hide loader
  setTimeout(hideLoader, 420);
});
// hard safety timeout: always hide loader after 3s
setTimeout(hideLoader, 3000);

/* ---------- Cursor + trail ---------- */
const cursor = $('#cursor');
let trailPool = [];
function spawnTrail(x,y){
  let el = trailPool.pop();
  if(!el){
    el = document.createElement('div');
    el.className = 'trail';
    document.body.appendChild(el);
  }
  el.style.left = x + 'px';
  el.style.top = y + 'px';
  el.style.opacity = '1';
  gsap.fromTo(el, {scale:1}, {scale:0.5, opacity:0, duration:0.9, ease:'power2.out', onComplete: ()=>{ trailPool.push(el); }});
}
document.addEventListener('mousemove', e=>{
  cursor.style.left = e.clientX + 'px';
  cursor.style.top = e.clientY + 'px';
  spawnTrail(e.clientX - 8, e.clientY - 8);
});
document.addEventListener('mousedown', ()=> cursor.style.transform = 'translate(-50%,-50%) scale(.85)');
document.addEventListener('mouseup', ()=> cursor.style.transform = 'translate(-50%,-50%) scale(1)');

/* ---------- Hero typewriter ---------- */
(function typewriter(){
  const el = document.getElementById('type');
  if(!el) return;
  const words = ['scalable data platforms','cloud architectures','reliable data pipelines','analytics-ready models'];
  let w=0,i=0,deleting=false;
  function tick(){
    const word = words[w];
    el.textContent = word.slice(0,i);
    if(!deleting) i++; else i--;
    if(!deleting && i === word.length){ deleting=true; setTimeout(tick,1200); return; }
    if(deleting && i === 0){ deleting=false; w=(w+1)%words.length; }
    setTimeout(tick, deleting?40:80);
  }
  tick();
})();

/* ---------- Reveal + skill bars ---------- */
function revealOnScroll(initial=false){
  $$('.reveal').forEach((r, idx)=>{
    const rect = r.getBoundingClientRect();
    if(rect.top < window.innerHeight - 120){
      if(!r.classList.contains('show')){
        r.classList.add('show');
        gsap.fromTo(r, {y:30, opacity:0}, {y:0, opacity:1, duration:1, ease:'expo.out', delay: idx*0.06});
        r.querySelectorAll('.fill').forEach((f,i)=>{
          const w = f.getAttribute('data-w') || '70%';
          gsap.to(f, {width:w, duration:1.6, delay:0.2 + i*0.12, ease:'power3.out'});
        });
      }
    } else if(!initial){
      // optional: remove
      // r.classList.remove('show');
    }
  });
}
window.addEventListener('scroll', revealOnScroll);

/* ---------- Modal ---------- */
function openModal(btn){
  const article = btn.closest('.project');
  const title = article.dataset.title || article.querySelector('h3').innerText;
  const desc = article.dataset.desc || article.querySelector('p').innerText;
  $('#modal-title').innerText = title;
  $('#modal-desc').innerText = desc;
  $('#modal').classList.add('show'); $('#modal').setAttribute('aria-hidden','false');
}
function closeModal(){ $('#modal').classList.remove('show'); $('#modal').setAttribute('aria-hidden','true'); }
document.addEventListener('keydown', e=> { if(e.key === 'Escape') closeModal(); });

/* ---------- Magnetic buttons + tilt + spotlight ---------- */
$$('.btn, .nav a').forEach(btn=>{
  btn.addEventListener('mousemove', e=>{
    const r = btn.getBoundingClientRect();
    const x = e.clientX - r.left - r.width/2;
    const y = e.clientY - r.top - r.height/2;
    btn.style.transform = `translate(${x/8}px,${y/8}px)`;
  });
  btn.addEventListener('mouseleave', ()=> btn.style.transform = '');
});
$$('.project').forEach(card=>{
  const spot = card.querySelector('.spot');
  card.addEventListener('mousemove', e=>{
    const rect = card.getBoundingClientRect();
    const rx = (e.clientX - rect.left)/rect.width;
    const ry = (e.clientY - rect.top)/rect.height;
    const px = (rx - .5) * 12;
    const py = (ry - .5) * -12;
    gsap.to(card, {duration:.5, rotateX:py, rotateY:px, scale:1.02, ease:'power3.out'});
    if(spot){
      const sx = rx * rect.width;
      const sy = ry * rect.height;
      gsap.to(spot, {left: sx+'px', top: sy+'px', opacity:0.95, duration:0.22, ease:'power2.out'});
    }
  });
  card.addEventListener('mouseleave', ()=>{
    gsap.to(card, {duration:.6, rotateX:0, rotateY:0, scale:1, ease:'power3.out'});
    if(card.querySelector('.spot')) gsap.to(card.querySelector('.spot'), {opacity:0, duration:.34});
  });
});

/* ---------- Scroll-speed warp (tiny motion blur mimic) ---------- */
let lastScroll = 0;
window.addEventListener('scroll', ()=>{
  const now = window.scrollY;
  const diff = Math.abs(now - lastScroll);
  document.body.style.filter = `blur(${Math.min(diff/60, 6)}px)`;
  clearTimeout(window._scrollBlur);
  window._scrollBlur = setTimeout(()=> document.body.style.filter = 'none', 120);
  lastScroll = now;
});

/* ---------- Click particle pulse (calls into particles setup) ---------- */
document.addEventListener('click', ()=> {
  if(window.pulseParticles) window.pulseParticles(5);
});

/* ---------- Audio reactive toggle (mic) ---------- */
let audioCtx, analyser, micStream;
$('#audioToggle').addEventListener('click', async (e)=>{
  e.preventDefault();
  if($('#audioToggle').dataset.active === '1'){
    $('#audioToggle').dataset.active = '0';
    $('#audioToggle').textContent = 'Enable Sound';
    if(micStream) { micStream.getTracks().forEach(t=>t.stop()); micStream=null; }
    if(audioCtx){ audioCtx.close(); audioCtx=null; }
    return;
  }
  try{
    const stream = await navigator.mediaDevices.getUserMedia({audio:true});
    micStream = stream;
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const src = audioCtx.createMediaStreamSource(stream);
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 2048;
    src.connect(analyser);
    $('#audioToggle').dataset.active = '1';
    $('#audioToggle').textContent = 'Sound On';
    const data = new Uint8Array(analyser.frequencyBinCount);
    (function read(){
      if(!analyser) return;
      analyser.getByteFrequencyData(data);
      let sum=0; for(let i=0;i<data.length;i++) sum+=data[i];
      const avg = sum / data.length;
      const intensity = Math.min(8, avg / 18);
      if(window.pulseParticles) window.pulseParticles(intensity);
      requestAnimationFrame(read);
    })();
  } catch(err){
    alert('Microphone access denied or not available.');
    console.warn(err);
  }
});

/* ---------- Perf toggle (controls WebGL) ---------- */
let heavy = true;
$('#perfBtn').addEventListener('click', ()=> {
  heavy = !heavy;
  $('#perfBtn').textContent = heavy ? 'Perf: Full' : 'Perf: Lite';
  if(window.particles) window.particles.setEnabled(heavy);
});

/* ---------- Reveal initial on load ---------- */
function initialActions(){
  revealOnScroll(true);
  animateHeroExplode();
}
function animateHeroExplode(){
  gsap.from('.h1', {scale:0.82, opacity:0, duration:1.4, ease:'expo.out'});
}
window.addEventListener('load', initialActions);

/* =============================
   WebGL Particles (shader points)
   - gravity field toward cursor
   - pulseParticles(amount) exposed globally
   - safe fallback: if fails, loader hides
   ============================= */
(function initParticles(){
  try{
    const canvas = document.getElementById('glCanvas');
    const renderer = new THREE.WebGLRenderer({canvas, antialias:true, alpha:true});
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setSize(window.innerWidth, window.innerHeight);
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 1, 4000);
    camera.position.set(0,0,500);

    // geometry attributes
    const COUNT = 18000;
    const positions = new Float32Array(COUNT*3);
    const colors = new Float32Array(COUNT*3);
    const sizes = new Float32Array(COUNT);
    for(let i=0;i<COUNT;i++){
      const a = Math.random()*Math.PI*2;
      const r = 240 + Math.random()*1000;
      positions[i*3] = Math.cos(a)*r*(0.55 + Math.random()*0.85);
      positions[i*3+1] = Math.sin(a)*r*(0.55 + Math.random()*0.85);
      positions[i*3+2] = (Math.random()-0.5)*1800;
      const t = Math.random();
      colors[i*3] = 0.4 + 0.6*t;
      colors[i*3+1] = 0.9;
      colors[i*3+2] = 1.0;
      sizes[i] = 1 + Math.random()*4;
    }

    const geom = new THREE.BufferGeometry();
    geom.setAttribute('position', new THREE.BufferAttribute(positions,3));
    geom.setAttribute('aColor', new THREE.BufferAttribute(colors,3));
    geom.setAttribute('aSize', new THREE.BufferAttribute(sizes,1));

    const mat = new THREE.ShaderMaterial({
      transparent:true,
      depthTest:true,
      blending:THREE.AdditiveBlending,
      uniforms:{
        uTime:{value:0},
        uPixel:{value:Math.min(window.devicePixelRatio,2)},
        uAccent1:{value:new THREE.Color('#00e5ff')},
        uAccent2:{value:new THREE.Color('#8c7bff')},
        uMouse:{value:new THREE.Vector2(0,0)},
        uIntensity:{value:1.0}
      },
      vertexShader: `
        attribute float aSize;
        attribute vec3 aColor;
        varying vec3 vColor;
        uniform float uTime;
        uniform vec2 uMouse;
        void main(){
          vColor = aColor;
          vec3 p = position;
          float t = uTime*0.28;
          p.x += sin(t + position.y * 0.006) * 9.0 * (aSize * 0.6);
          p.y += cos(t + position.x * 0.005) * 9.0 * (aSize * 0.6);
          // small mouse bend (gravity-like)
          vec2 m = uMouse * 700.0;
          float d = distance(m, p.xy);
          p.z += sin(t + d*0.01) * 3.0;
          vec4 mv = modelViewMatrix * vec4(p,1.0);
          gl_PointSize = aSize * (240.0 / -mv.z) * uPixel;
          gl_Position = projectionMatrix * mv;
        }
      `,
      fragmentShader: `
        uniform vec3 uAccent1;
        uniform vec3 uAccent2;
        varying vec3 vColor;
        void main(){
          vec2 c = gl_PointCoord - vec2(0.5);
          float d = length(c);
          float a = 1.0 - smoothstep(0.32,0.55,d);
          vec3 col = mix(uAccent1, uAccent2, vColor.r);
          gl_FragColor = vec4(col, a * 0.95);
        }
      `
    });

    const points = new THREE.Points(geom, mat);
    scene.add(points);

    // responsive
    window.addEventListener('resize', ()=> {
      renderer.setSize(window.innerWidth, window.innerHeight);
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
    });

    // mouse
    const mouse = new THREE.Vector2(0,0);
    document.addEventListener('mousemove', (e)=> {
      mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
      mouse.y = - (e.clientY / window.innerHeight) * 2 + 1;
      mat.uniforms.uMouse.value.set(mouse.x, mouse.y);
    });

    // gravity field variables (subtle)
    let enabled = true;
    const clock = new THREE.Clock();
    function animate(){
      if(enabled){
        mat.uniforms.uTime.value = clock.getElapsedTime();
        // gravity-like rotation toward mouse
        const gx = mouse.x * 120;
        const gy = mouse.y * 80;
        points.rotation.y += (gx * 0.00003);
        points.rotation.x += (gy * 0.00003);
        camera.position.x += (mouse.x * 100 - camera.position.x) * 0.06;
        camera.position.y += (mouse.y * 40 - camera.position.y) * 0.06;
        camera.lookAt(0,0,0);
        renderer.render(scene, camera);
      } else {
        renderer.clear();
      }
      requestAnimationFrame(animate);
    }
    animate();

    // Expose control + pulse
    window.particles = {
      setEnabled: v => { enabled = !!v; if(!enabled) renderer.clear(); },
      setIntensity: s => { mat.uniforms.uIntensity.value = s; },
      pulse: amt => {
        const arr = geom.attributes.position.array;
        for(let i=0;i<arr.length;i++){
          arr[i] += (Math.random()-0.5) * amt;
        }
        geom.attributes.position.needsUpdate = true;
      }
    };

    // helper alias for previous naming
    window.pulseParticles = (amt=1) => { if(window.particles) window.particles.pulse(amt); };

    // default enabled
    window.particles.setEnabled(true);

  } catch(e){
    console.warn('WebGL init failed:', e);
    // degrade: hide loader and continue
    hideLoader();
  }
})();

/* ---------- Final console tip ---------- */
console.info('Final Form loaded â€” try hover, move mouse, click (particle bursts), enable sound (mic) or toggle perf.');
</script>
</body>
</html>
